<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Demander pret</title>
  </head>
  <body>
    <h1>Demander un prets</h1>
    <div>
      <p class="client"></p>
      <p class="type_pret"></p>
      <br />
      <label for="montant"> Montant demand√© : </label>
      <input
        type="number"
        id="montant"
        name="montant"
        min="0"
        placeholder="100000, 2000000, ..."
      />
      <br /><br />
      <label for="mois_max">Mois max : </label>
      <input
        type="numbre"
        id="mois_max"
        name="mois_max"
        min="0"
        placeholder="10, 20, ..."
      />
      <br /><br />
      <button onclick="demanderPret()">Demander</button>
    </div>
    <script>
      const apiBase = "http://localhost/serveur/S4/WEB_S4_MVC/ws";

      function ajax(method, url, data, callback) {
        const xhr = new XMLHttpRequest();
        xhr.open(method, apiBase + url, true);
        xhr.setRequestHeader(
          "Content-Type",
          "application/x-www-form-urlencoded"
        );
        xhr.onreadystatechange = () => {
          if (xhr.readyState === 4 && xhr.status === 200) {
            callback(JSON.parse(xhr.responseText));
          }
        };
        xhr.send(data);
      }

      function clientActuel() {
        ajax("GET", "/currentClient", null, (data) => {
          const pClient = document.querySelector(".client");

          const input = document.createElement("input");
          input.type = "hidden";
          input.id = "id_client";
          input.name = "id_client";
          input.value = data.id_client;

          console.log("Client ID :", data.id_client);

          // ‚ö†Ô∏è IMPORTANT : l'ajouter au DOM !
          pClient.appendChild(input);
        });
      }

      function chargerTypePrets() {
        ajax("GET", "/type_prets", null, (data) => {
          const pTypePret = document.querySelector(".type_pret");

          const select = document.createElement("select");
          select.id = "type_pret";
          select.name = "type_pret";

          const optionDefault = document.createElement("option");
          optionDefault.value = "";
          optionDefault.textContent = "-- Choisir un type de pr√™t --";
          select.appendChild(optionDefault);

          data.forEach((item) => {
            const option = document.createElement("option");
            option.value = item.id_type_pret;
            option.textContent = item.nom;
            select.appendChild(option);
          });

          pTypePret.innerHTML = "";
          pTypePret.appendChild(select);
        });
      }

      function demanderPret() {
        // ajax("POST", "/prets", null, (data) => {
          const id_type_pret = document.getElementById("type_pret").value;
          const montant = document.getElementById("montant").value;
          const mois_max = document.getElementById("mois_max").value;
          const id_client = document.getElementById("id_client").value;

          console.log("üìù Donn√©es du formulaire :");
          console.log("ID Type Pr√™t :", id_type_pret);
          console.log("Montant :", montant);
          console.log("Mois max :", mois_max);
          console.log("ID Client :", id_client);
        // });
      }

      document.addEventListener("DOMContentLoaded", chargerTypePrets);
      document.addEventListener("DOMContentLoaded", clientActuel);
    </script>
  </body>
</html>
